<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D –¢–†–ò–ó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: #0a0a0f;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .controls-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 25, 0.92);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(100, 150, 255, 0.2);
            border-radius: 20px;
            padding: 14px 24px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(100, 150, 255, 0.1) inset;
            display: flex;
            gap: 14px;
            align-items: center;
            z-index: 100;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 95%;
        }

        .face-controls-panel {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 25, 0.92);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(100, 150, 255, 0.2);
            border-radius: 20px;
            padding: 14px 24px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(100, 150, 255, 0.1) inset;
            display: none;
            gap: 14px;
            align-items: center;
            z-index: 100;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 95%;
        }

        .face-controls-panel.active {
            display: flex;
        }

        .face-controls-panel .label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-right: 8px;
            font-weight: 300;
        }

        .btn-face {
            background: rgba(100, 150, 255, 0.15);
            border: 1px solid rgba(100, 150, 255, 0.3);
            color: rgba(255, 255, 255, 0.9);
        }

        .btn-face:hover {
            background: rgba(100, 150, 255, 0.25);
            border-color: rgba(100, 150, 255, 0.4);
        }

        .btn-face:active {
            background: rgba(100, 150, 255, 0.3);
        }

        /* –°–ø–∏—Å–æ–∫ –≥—Ä–∞–Ω–µ–π (–Ω–æ–º–µ—Ä–∞ 1‚Äì12) */
        .face-list {
            position: fixed;
            top: 50%;
            right: 24px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 10px 12px;
            background: rgba(15, 20, 35, 0.96);
            border-radius: 18px;
            box-shadow: 0 12px 36px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.18);
            z-index: 150; /* –≤—ã—à–µ –ø–∞–Ω–µ–ª–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
            max-height: 80%;
            overflow-y: auto;
            scrollbar-width: none;
        }

        .face-list::-webkit-scrollbar {
            display: none;
        }

        .face-list-item {
            min-width: 36px;
            height: 36px;
            border-radius: 10px;
            border: 1px solid rgba(100, 150, 255, 0.25);
            background: rgba(30, 35, 50, 0.6);
            color: rgba(255, 255, 255, 0.85);
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0 10px;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .face-list-item:hover {
            background: rgba(50, 70, 100, 0.7);
            border-color: rgba(100, 150, 255, 0.4);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 0 15px rgba(100, 150, 255, 0.25);
        }

        .face-list-item.active {
            background: linear-gradient(135deg, rgba(100, 150, 255, 0.95) 0%, rgba(120, 170, 255, 0.95) 100%);
            border-color: rgba(100, 150, 255, 1);
            color: #0a0a0f;
            font-weight: 700;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(100, 150, 255, 0.5), 0 0 25px rgba(100, 150, 255, 0.4);
        }

        .control-group {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .control-group label {
            display: none;
        }

        .btn {
            background: rgba(30, 35, 50, 0.7);
            border: 1px solid rgba(100, 150, 255, 0.25);
            color: rgba(255, 255, 255, 0.95);
            width: 48px;
            height: 48px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(12px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 0 0 0 rgba(100, 150, 255, 0);
        }

        .btn:hover {
            background: rgba(50, 70, 100, 0.8);
            border-color: rgba(100, 150, 255, 0.5);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4), 0 0 20px rgba(100, 150, 255, 0.3);
        }

        .btn:active {
            transform: translateY(0) scale(0.98);
            background: rgba(70, 100, 150, 0.9);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 10px rgba(100, 150, 255, 0.2);
        }

        .title {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.98);
            font-size: 36px;
            font-weight: 700;
            letter-spacing: 3px;
            z-index: 100;
            text-align: center;
            text-shadow: 0 2px 20px rgba(100, 150, 255, 0.4), 0 0 40px rgba(100, 150, 255, 0.2);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(200, 220, 255, 0.95) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .info {
            display: none;
        }

        @media (max-width: 768px) {
            .face-list {
                top: auto;
                bottom: 110px;
                right: 12px;
                transform: none;
                flex-direction: row;
                max-width: 85%;
                max-height: none;
                padding: 6px 8px;
            }
            .controls-panel {
                bottom: 12px;
                padding: 10px 12px;
                gap: 8px;
                border-radius: 12px;
            }

            .btn {
                width: 48px;
                height: 48px;
                font-size: 20px;
            }

            .title {
                font-size: 28px;
                top: 16px;
                letter-spacing: 2px;
            }

            .control-group {
                gap: 6px;
            }
        }

        @media (max-width: 480px) {
            .controls-panel {
                bottom: 8px;
                padding: 8px 10px;
                gap: 6px;
            }

            .btn {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }

            .title {
                font-size: 22px;
                top: 12px;
                letter-spacing: 1.5px;
            }
        }

        .separator {
            display: none;
        }

        .hint-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 32px 40px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .hint-notification.show {
            opacity: 1;
            pointer-events: auto;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0f;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 24px;
            letter-spacing: 1px;
        }

        .progress-bar-container {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, rgba(100, 150, 255, 0.8) 0%, rgba(120, 170, 255, 0.9) 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
            box-shadow: 0 0 20px rgba(100, 150, 255, 0.5);
        }

        .progress-percent {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-top: 12px;
            font-weight: 300;
        }

        @media (max-width: 768px) {
            .loading-text {
                font-size: 20px;
            }

            .progress-bar-container {
                width: 250px;
            }
        }

        .hint-notification h3 {
            color: rgba(255, 255, 255, 0.95);
            font-size: 24px;
            font-weight: 300;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }

        .hint-notification p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .hint-notification .hint-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.8;
        }

        .hint-notification .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.8);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .hint-notification .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .hint-notification {
                padding: 24px 28px;
                border-radius: 16px;
            }

            .hint-notification h3 {
                font-size: 20px;
                margin-bottom: 16px;
            }

            .hint-notification p {
                font-size: 14px;
                margin-bottom: 10px;
            }

            .hint-notification .hint-icon {
                font-size: 36px;
                margin-bottom: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="title">3D –¢–†–ò–ó</div>
    <div id="canvas-container"></div>
    
    <div class="face-list" id="face-list"></div>
    
    <!-- –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤..</div>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
        </div>
        <div class="progress-percent" id="progress-percent">0%</div>
    </div>

    <div class="controls-panel">
        <button class="btn" id="zoom-in" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å">+</button>
        <button class="btn" id="zoom-out" title="–û—Ç–¥–∞–ª–∏—Ç—å">‚àí</button>
        <button class="btn" id="reset" title="–°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥">‚ü≤</button>
    </div>

    <div class="face-controls-panel" id="face-controls-panel">
        <span class="label">–í—Ä–∞—â–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏:</span>
        <button class="btn btn-face" id="face-rotate-left" title="–í—Ä–∞—â–∞—Ç—å –≥—Ä–∞–Ω—å –≤–ª–µ–≤–æ">‚Ü∫</button>
        <button class="btn btn-face" id="face-rotate-right" title="–í—Ä–∞—â–∞—Ç—å –≥—Ä–∞–Ω—å –≤–ø—Ä–∞–≤–æ">‚Üª</button>
        <button class="btn btn-face" id="face-deselect" title="–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ">‚úï</button>
    </div>

    <div class="hint-notification" id="hint-notification">
        <button class="close-btn" id="close-hint">√ó</button>
        <div class="hint-icon">üîÑ</div>
        <h3>–ö–∞–∫ –≤—Ä–∞—â–∞—Ç—å –º–æ–¥–µ–ª—å</h3>
        <p id="hint-text-desktop">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –º—ã—à—å—é –ø–æ –º–æ–¥–µ–ª–∏, —á—Ç–æ–±—ã –≤—Ä–∞—â–∞—Ç—å –µ—ë</p>
        <p id="hint-text-mobile" style="display: none;">–ü—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º –ø–æ —ç–∫—Ä–∞–Ω—É, —á—Ç–æ–±—ã –≤—Ä–∞—â–∞—Ç—å –º–æ–¥–µ–ª—å</p>
        <p style="font-size: 14px; opacity: 0.6; margin-top: 16px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–ª–µ—Å–∏–∫–æ –º—ã—à–∏ –∏–ª–∏ –∂–µ—Å—Ç—ã –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ü–µ–Ω—ã
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.set(0, 0, 5);
        camera.lookAt(0, 0, 0); // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–º–µ—Ä–µ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ü–µ–Ω—Ç—Ä —Å—Ü–µ–Ω—ã

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω
        renderer.setClearColor(0x0a0a0f, 1);
        renderer.shadowMap.enabled = false;

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞–Ω–µ–ª—å —Å–ø–∏—Å–∫–∞ –≥—Ä–∞–Ω–µ–π (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–∑–∂–µ)
        let faceListElement = null;
        
        const canvas = renderer.domElement;
        canvas.style.display = 'block';
        canvas.style.width = '100%';
        canvas.style.height = '100%';
        canvas.style.position = 'absolute';
        canvas.style.top = '0';
        canvas.style.left = '0';
        canvas.style.zIndex = '1'; // –ü–æ–¥ UI —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏, –Ω–æ –≤–∏–¥–µ–Ω
        
        document.getElementById('canvas-container').appendChild(canvas);
        
        console.log('–†–µ–Ω–¥–µ—Ä–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, —Ä–∞–∑–º–µ—Ä:', window.innerWidth, 'x', window.innerHeight);
        console.log('Canvas —ç–ª–µ–º–µ–Ω—Ç:', canvas);
        console.log('Canvas —Ä–∞–∑–º–µ—Ä—ã:', canvas.width, 'x', canvas.height);
        
        // –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ canvas
        setTimeout(() => {
            const canvasStyle = window.getComputedStyle(canvas);
            const containerStyle = window.getComputedStyle(document.getElementById('canvas-container'));
            console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê CANVAS ===');
            console.log('Canvas –≤ DOM:', document.getElementById('canvas-container').contains(canvas));
            console.log('Canvas display:', canvasStyle.display);
            console.log('Canvas visibility:', canvasStyle.visibility);
            console.log('Canvas opacity:', canvasStyle.opacity);
            console.log('Canvas z-index:', canvasStyle.zIndex);
            console.log('Canvas position:', canvasStyle.position);
            console.log('Canvas top:', canvasStyle.top);
            console.log('Canvas left:', canvasStyle.left);
            console.log('Canvas width:', canvasStyle.width);
            console.log('Canvas height:', canvasStyle.height);
            console.log('Container width:', containerStyle.width);
            console.log('Container height:', containerStyle.height);
            console.log('Container position:', containerStyle.position);
            console.log('Container z-index:', containerStyle.zIndex);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ WebGL –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            const gl = renderer.getContext();
            console.log('WebGL –∫–æ–Ω—Ç–µ–∫—Å—Ç:', gl ? '–µ—Å—Ç—å' : '–Ω–µ—Ç');
            if (gl) {
                console.log('WebGL –≤–µ—Ä—Å–∏—è:', gl.getParameter(gl.VERSION));
                console.log('WebGL vendor:', gl.getParameter(gl.VENDOR));
                console.log('WebGL renderer:', gl.getParameter(gl.RENDERER));
            }
        }, 100);

        // –û—Å–≤–µ—â–µ–Ω–∏–µ –¥–ª—è –º—è–≥–∫–æ–π —Å–≤–µ—Ç–æ—Ç–µ–Ω–∏
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        // –û—Å–Ω–æ–≤–Ω–æ–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–≤–µ—Ç —Å–≤–µ—Ä—Ö—É —Å–ª–µ–≤–∞ –¥–ª—è –º—è–≥–∫–æ–π —Å–≤–µ—Ç–æ—Ç–µ–Ω–∏
        const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight1.position.set(5, 8, 5);
        directionalLight1.castShadow = false;
        scene.add(directionalLight1);

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º—è–≥–∫–∏–π —Å–≤–µ—Ç —Å–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ–Ω–µ–π
        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.3);
        directionalLight2.position.set(-3, -5, -3);
        directionalLight2.castShadow = false;
        scene.add(directionalLight2);
        
        console.log('–û—Å–≤–µ—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å—Ü–µ–Ω—É');

        // –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞
        const geometry = new THREE.DodecahedronGeometry(1, 0);
        console.log('–ì–µ–æ–º–µ—Ç—Ä–∏—è –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞:', geometry);
        const materials = [];
        
        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –±–µ–ª–æ–π —Ç–µ–∫—Å—Ç—É—Ä—ã —Å –Ω–æ–º–µ—Ä–æ–º –≥—Ä–∞–Ω–∏
        function createNumberedTexture(faceNumber) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');
            
            // –ë–µ–ª—ã–π —Ñ–æ–Ω
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 512, 512);
            
            // –ß–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –≥—Ä–∞–Ω–∏ - —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 180px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // –†–∏—Å—É–µ–º –Ω–æ–º–µ—Ä –≤ —Ü–µ–Ω—Ç—Ä–µ, –∑–µ—Ä–∫–∞–ª—å–Ω–æ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏,
            // —á—Ç–æ–±—ã —Å–Ω–∞—Ä—É–∂–∏ –º–æ–¥–µ–ª–∏ —Ç–µ–∫—Å—Ç –±—ã–ª –ù–ï –∑–µ—Ä–∫–∞–ª—å–Ω—ã–π
            ctx.save();
            ctx.translate(512, 0);
            ctx.scale(-1, 1);
            ctx.fillText(faceNumber.toString(), 256, 256);
            ctx.restore();
            
            const texture = new THREE.CanvasTexture(canvas);
            texture.wrapS = THREE.ClampToEdgeWrapping;
            texture.wrapT = THREE.ClampToEdgeWrapping;
            texture.flipY = false; // –í–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
            return texture;
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≥–ª—É—à–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä—ã
        function createPlaceholderTexture(filename) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, 512, 512);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.font = 'bold 64px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(filename.replace('.jpg', ''), 256, 256);
            
            const texture = new THREE.CanvasTexture(canvas);
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.RepeatWrapping;
            return texture;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π CORS
        function loadImageAsTexture(filename) {
            return new Promise((resolve, reject) => {
                const textureLoader = new THREE.TextureLoader();
                
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ TextureLoader
                textureLoader.load(
                    filename,
                    (texture) => {
                        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        texture.wrapS = THREE.ClampToEdgeWrapping;
                        texture.wrapT = THREE.ClampToEdgeWrapping;
                        texture.flipY = false;
                        resolve(texture);
                    },
                    undefined,
                    (error) => {
                        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ Image –∏ Canvas
                        const img = new Image();
                        img.crossOrigin = 'anonymous';
                        
                        img.onload = function() {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width;
                            canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            
                            const texture = new THREE.CanvasTexture(canvas);
                            texture.wrapS = THREE.ClampToEdgeWrapping;
                            texture.wrapT = THREE.ClampToEdgeWrapping;
                            texture.flipY = false;
                            resolve(texture);
                        };
                        
                        img.onerror = function() {
                            // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
                            resolve(createPlaceholderTexture(filename));
                        };
                        
                        // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏
                        const paths = [
                            filename,
                            `./${filename}`,
                            `${window.location.pathname.replace(/\/[^/]*$/, '')}/${filename}`
                        ];
                        
                        let pathIndex = 0;
                        const tryNextPath = () => {
                            if (pathIndex < paths.length) {
                                img.src = paths[pathIndex++];
                            } else {
                                img.onerror();
                            }
                        };
                        
                        const originalError = img.onerror;
                        img.onerror = function() {
                            if (pathIndex < paths.length) {
                                tryNextPath();
                            } else {
                                originalError.call(this);
                            }
                        };
                        
                        tryNextPath();
                    }
                );
            });
        }
        
        // –°–æ–∑–¥–∞–µ–º –¥–æ–¥–µ–∫–∞—ç–¥—Ä —Å –æ–¥–Ω–∏–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        const testMaterial = new THREE.MeshBasicMaterial({
            color: 0x00ff00, // –Ø—Ä–∫–∏–π –∑–µ–ª–µ–Ω—ã–π –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
            side: THREE.DoubleSide,
            transparent: false,
            opacity: 1.0
        });
        
        const dodecahedron = new THREE.Mesh(geometry, testMaterial);
        dodecahedron.position.set(0, 0, 0);
        dodecahedron.scale.set(3, 3, 3);
        dodecahedron.visible = false; // –°–∫—Ä—ã–≤–∞–µ–º –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç—É—Ä
        scene.add(dodecahedron);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—Ä–∏—Ü—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ scale
        dodecahedron.updateMatrix();
        dodecahedron.updateMatrixWorld();
        
        // –°–æ–∑–¥–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä–∞–Ω–∏ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å —Ç–µ–∫—Å—Ç—É—Ä–∞–º–∏)
        const basicMaterials = [];
        for (let i = 0; i < 12; i++) {
            basicMaterials.push(new THREE.MeshBasicMaterial({
                color: 0xffffff,
                side: THREE.DoubleSide,
                transparent: false,
                opacity: 1.0
            }));
        }
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã —É–¥–∞–ª–µ–Ω—ã - –¥–æ–¥–µ–∫–∞—ç–¥—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
        console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä scale –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:', dodecahedron.scale);
        console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä —Å–æ–∑–¥–∞–Ω —Å –∑–µ–ª–µ–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º –¥–ª—è —Ç–µ—Å—Ç–∞');
        console.log('–í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Å—Ü–µ–Ω–µ:', scene.children.length);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –¥–æ–¥–µ–∫–∞—ç–¥—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        window.dodecahedron = dodecahedron;
        window.dodecahedronMaterials = basicMaterials; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        window.dodecahedronGeometry = geometry;
        
        console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä —Å–æ–∑–¥–∞–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å—Ü–µ–Ω—É');
        console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä –≤ —Å—Ü–µ–Ω–µ:', scene.children.includes(dodecahedron));
        console.log('–ü–æ–∑–∏—Ü–∏—è –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞:', dodecahedron.position);
        console.log('–ü–æ–∑–∏—Ü–∏—è –∫–∞–º–µ—Ä—ã:', camera.position);
        console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–π –≤ —Å—Ü–µ–Ω–µ:', scene.children.length);
        console.log('–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞:', dodecahedron.material);
        
        // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –í–ò–î–ò–ú–û–°–¢–ò ===');
        console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä visible:', dodecahedron.visible);
        console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä scale:', dodecahedron.scale);
        const currentMaterial = Array.isArray(dodecahedron.material) ? dodecahedron.material[0] : dodecahedron.material;
        console.log('–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞:', currentMaterial?.type);
        console.log('–¶–≤–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞:', currentMaterial?.color?.getHex());
        console.log('–ú–∞—Ç–µ—Ä–∏–∞–ª visible:', currentMaterial?.visible);
        console.log('–ú–∞—Ç–µ—Ä–∏–∞–ª transparent:', currentMaterial?.transparent);
        console.log('–ú–∞—Ç–µ—Ä–∏–∞–ª opacity:', currentMaterial?.opacity);
        const verticesCount = geometry.attributes?.position ? geometry.attributes.position.count / 3 : (geometry.vertices?.length || 0);
        const facesCount = geometry.index ? geometry.index.count / 3 : (geometry.faces?.length || verticesCount / 3);
        console.log('–ì–µ–æ–º–µ—Ç—Ä–∏—è vertices:', verticesCount);
        console.log('–ì–µ–æ–º–µ—Ç—Ä–∏—è faces:', facesCount);
        console.log('–¢–∏–ø –≥–µ–æ–º–µ—Ç—Ä–∏–∏:', geometry.type);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ frustum
        const frustum = new THREE.Frustum();
        camera.updateMatrixWorld();
        const matrix = new THREE.Matrix4().multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);
        frustum.setFromProjectionMatrix(matrix);
        console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä –≤ frustum –∫–∞–º–µ—Ä—ã:', frustum.intersectsObject(dodecahedron));
        
        // Bounding box
        const bbox = new THREE.Box3().setFromObject(dodecahedron);
        const bboxCenter = bbox.getCenter(new THREE.Vector3());
        const bboxSize = bbox.getSize(new THREE.Vector3());
        console.log('Bounding box min:', bbox.min.x, bbox.min.y, bbox.min.z);
        console.log('Bounding box max:', bbox.max.x, bbox.max.y, bbox.max.z);
        console.log('Bounding box center:', bboxCenter.x, bboxCenter.y, bboxCenter.z);
        console.log('Bounding box size:', bboxSize.x, bboxSize.y, bboxSize.z);
        console.log('–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –∫–∞–º–µ—Ä—ã –¥–æ —Ü–µ–Ω—Ç—Ä–∞:', camera.position.distanceTo(bboxCenter));
        console.log('–ö–∞–º–µ—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞:', camera.getWorldDirection(new THREE.Vector3()));
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ —ç–∫—Ä–∞–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
        const vector = new THREE.Vector3();
        dodecahedron.getWorldPosition(vector);
        vector.project(camera);
        console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä –≤ —ç–∫—Ä–∞–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö:', 
            (vector.x * 0.5 + 0.5) * window.innerWidth, 
            (vector.y * -0.5 + 0.5) * window.innerHeight);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª - –¥–ª—è file:// –Ω—É–∂–µ–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
        const isFileProtocol = window.location.protocol === 'file:';
        if (isFileProtocol) {
            console.warn('‚ö†Ô∏è –§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ file:// –ø—Ä–æ—Ç–æ–∫–æ–ª. –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π HTTP —Å–µ—Ä–≤–µ—Ä:');
            console.warn('   Python: python -m http.server 8000');
            console.warn('   Node.js: npx http-server');
            console.warn('   –ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000');
        }
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
        const loadingOverlay = document.getElementById('loading-overlay');
        const progressBar = document.getElementById('progress-bar');
        const progressPercent = document.getElementById('progress-percent');
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress(loaded, total) {
            const percent = Math.round((loaded / total) * 100);
            progressBar.style.width = percent + '%';
            progressPercent.textContent = percent + '%';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –≥—Ä–∞–Ω–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –Ω–∞–ª–æ–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä—ã
        function calculateFaceOrientation(geometry, faceIndex) {
            const group = geometry.groups[faceIndex];
            if (!group) return { rotation: 0, flipX: false, flipY: false };
            
            const positions = geometry.attributes.position;
            const indices = geometry.index;
            if (!positions || !indices) return { rotation: 0, flipX: false, flipY: false };
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –≤–µ—Ä—à–∏–Ω –¥–ª—è —ç—Ç–æ–π –≥—Ä–∞–Ω–∏
            const vertexIndices = [];
            const vertexSet = new Set();
            
            for (let i = 0; i < group.count; i++) {
                const indexPos = group.start + i;
                if (indexPos < indices.count) {
                    const vertexIndex = indices.getX(indexPos);
                    if (!vertexSet.has(vertexIndex)) {
                        vertexSet.add(vertexIndex);
                        vertexIndices.push(vertexIndex);
                    }
                }
            }
            
            if (vertexIndices.length < 3) return { rotation: 0, flipX: false, flipY: false };
            
            // –ü–æ–ª—É—á–∞–µ–º –≤–µ—Ä—à–∏–Ω—ã –≥—Ä–∞–Ω–∏
            const vertices = vertexIndices.map(idx => new THREE.Vector3(
                positions.getX(idx),
                positions.getY(idx),
                positions.getZ(idx)
            ));
            
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ—Ä–º–∞–ª—å –≥—Ä–∞–Ω–∏
            const v0 = vertices[0];
            const v1 = vertices[1];
            const v2 = vertices[2];
            let normal = new THREE.Vector3()
                .subVectors(v1, v0)
                .cross(new THREE.Vector3().subVectors(v2, v0))
                .normalize();
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –Ω–æ—Ä–º–∞–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞—Ä—É–∂—É (–æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞)
            const center = new THREE.Vector3();
            vertices.forEach(v => center.add(v));
            center.divideScalar(vertices.length);
            const toCenter = new THREE.Vector3().subVectors(new THREE.Vector3(0, 0, 0), center);
            if (normal.dot(toCenter) > 0) {
                normal.negate();
            }
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—É—é –≤–µ—Ä—Ö–Ω—é—é –≤–µ—Ä—à–∏–Ω—É (—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º Y –≤ –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö)
            let topVertex = vertices[0];
            for (let i = 1; i < vertices.length; i++) {
                if (vertices[i].y > topVertex.y) {
                    topVertex = vertices[i];
                }
            }
            
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –∫ –≤–µ—Ä—Ö–Ω–µ–π –≤–µ—Ä—à–∏–Ω–µ
            const toTop = new THREE.Vector3().subVectors(topVertex, center).normalize();
            
            // –°–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–∞ –≥—Ä–∞–Ω–∏
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏—Ä–æ–≤—É—é –æ—Å—å Y –∫–∞–∫ –æ–ø–æ—Ä–Ω—É—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–∏—Å–∞
            const worldUp = new THREE.Vector3(0, 1, 0);
            let right = new THREE.Vector3().crossVectors(worldUp, normal).normalize();
            
            // –ï—Å–ª–∏ –Ω–æ—Ä–º–∞–ª—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞ Y, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä—É–≥—É—é –æ—Å—å
            if (right.length() < 0.1) {
                const worldRight = new THREE.Vector3(1, 0, 0);
                right = new THREE.Vector3().crossVectors(worldRight, normal).normalize();
            }
            
            const up = new THREE.Vector3().crossVectors(normal, right).normalize();
            
            // –ü—Ä–æ–µ—Ü–∏—Ä—É–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –≤–µ—Ä—Ö–Ω–µ–π –≤–µ—Ä—à–∏–Ω–µ –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç—å –≥—Ä–∞–Ω–∏
            const toTopInPlane = new THREE.Vector3()
                .addScaledVector(right, toTop.dot(right))
                .addScaledVector(up, toTop.dot(up))
                .normalize();
            
            // –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ —Ç–µ–∫—Å—Ç—É—Ä—ã
            // –í —Ç–µ–∫—Å—Ç—É—Ä–µ "–≤–≤–µ—Ä—Ö" —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é (0, 1) –≤ UV-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
            // –ù–∞–º –Ω—É–∂–Ω–æ –≤—ã—Ä–æ–≤–Ω—è—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –≤–µ—Ä—Ö–Ω–µ–π –≤–µ—Ä—à–∏–Ω–µ —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º "–≤–≤–µ—Ä—Ö" –≤ —Ç–µ–∫—Å—Ç—É—Ä–µ
            // atan2(y, x) –¥–∞–µ—Ç —É–≥–æ–ª –æ—Ç –æ—Å–∏ X
            const angle = Math.atan2(toTopInPlane.dot(up), toTopInPlane.dot(right));
            
            // –î–ª—è –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞ –∫–∞–∂–¥–∞—è –≥—Ä–∞–Ω—å –∏–º–µ–µ—Ç —Å–≤–æ—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–æ—Ä–º–∞–ª–∏
            // –ï—Å–ª–∏ –Ω–æ—Ä–º–∞–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –æ—Å–∏, –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ
            const needsFlipX = Math.abs(normal.x) > 0.7 && normal.x < 0;
            const needsFlipY = Math.abs(normal.y) > 0.7 && normal.y < 0;
            
            return {
                rotation: angle,
                flipX: needsFlipX,
                flipY: needsFlipY
            };
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö 12 –≥—Ä–∞–Ω–µ–π
        const textures = [];
        const texturePromises = [];
        let loadedCount = 0;
        const totalTextures = 12;
        
        for (let i = 1; i <= 12; i++) {
            const filename = `${String(i).padStart(3, '0')}.png`;
            texturePromises.push(
                loadImageAsTexture(filename).then(texture => {
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—è—Ç–∏—É–≥–æ–ª—å–Ω–∏–∫–∞
                    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2111x2001, –ø—è—Ç–∏—É–≥–æ–ª—å–Ω–∏–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º
                    texture.wrapS = THREE.ClampToEdgeWrapping;
                    texture.wrapT = THREE.ClampToEdgeWrapping;
                    texture.flipY = false; // –í–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
                    
                    // –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–∑–∂–µ –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä–∞–Ω–∏
                    texture.offset.set(0, 0);
                    texture.repeat.set(1, 1);
                    texture.center.set(0.5, 0.5);
                    texture.rotation = 0;
                    
                    textures[i - 1] = texture;
                    loadedCount++;
                    updateProgress(loadedCount, totalTextures);
                    console.log(`‚úì –¢–µ–∫—Å—Ç—É—Ä–∞ ${filename} –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ (${loadedCount}/${totalTextures})`);
                    return texture;
                }).catch(err => {
                    console.warn(`‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${filename}, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É:`, err);
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–µ–∫—Å—Ç—É—Ä—É –∫–∞–∫ –∑–∞–≥–ª—É—à–∫—É
                    const placeholder = createNumberedTexture(i);
                    textures[i - 1] = placeholder;
                    loadedCount++;
                    updateProgress(loadedCount, totalTextures);
                    return placeholder;
                })
            );
        }
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç—É—Ä
        Promise.all(texturePromises).then(() => {
            console.log('–í—Å–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', textures.length);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä–∞–Ω–∏
            // (–≤—ã—á–∏—Å–ª–µ–Ω–∞ —Ä–∞–Ω–µ–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤)
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å —Ç–µ–∫—Å—Ç—É—Ä–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä–∞–Ω–∏
            const newMaterials = [];
            for (let i = 0; i < 12; i++) {
                const texture = textures[i];
                const orientation = faceOrientations[i];
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –∫ —Ç–µ–∫—Å—Ç—É—Ä–µ
                // –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
                texture.offset.set(0, 0);
                texture.repeat.set(1, 1);
                texture.center.set(0.5, 0.5);
                texture.rotation = 0;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–≤–æ—Ä–æ—Ç
                texture.rotation = orientation.rotation;
                
                // –ó–µ—Ä–∫–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç—É—Ä
                texture.offset.x = 1;
                texture.repeat.x = -1;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–ø–æ—Å–ª–µ –ø–æ–≤–æ—Ä–æ—Ç–∞ –∏ –±–∞–∑–æ–≤–æ–≥–æ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è)
                if (orientation.flipY) {
                    texture.offset.y = 1;
                    texture.repeat.y = -1;
                }
                
                console.log(`–¢–µ–∫—Å—Ç—É—Ä–∞ –≥—Ä–∞–Ω–∏ ${i + 1} –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞: rotation=${orientation.rotation.toFixed(3)}, flipX=${orientation.flipX}, flipY=${orientation.flipY}`);
                
                // –î–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ —Ñ–æ–Ω–∞ PNG –≤–∫–ª—é—á–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
                // –í–∞–∂–Ω–æ: alphaTest –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∏–∑–∫–∏–º, —á—Ç–æ–±—ã –Ω–µ –æ—Ç—Å–µ–∫–∞—Ç—å –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –ø–∏–∫—Å–µ–ª–∏
                newMaterials.push(new THREE.MeshStandardMaterial({
                    map: texture,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 1.0,
                    metalness: 0.1,
                    roughness: 0.7,
                    alphaTest: 0.01 // –ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
                }));
                
                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ç–µ–∫—Å—Ç—É—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
                if (texture.image) {
                    console.log(`–¢–µ–∫—Å—Ç—É—Ä–∞ –≥—Ä–∞–Ω–∏ ${i + 1} –∑–∞–≥—Ä—É–∂–µ–Ω–∞: ${texture.image.width}x${texture.image.height}`);
                } else {
                    console.warn(`–¢–µ–∫—Å—Ç—É—Ä–∞ –≥—Ä–∞–Ω–∏ ${i + 1} –Ω–µ –∏–º–µ–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!`);
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å—Å–∏–≤ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
            if (window.dodecahedron) {
                window.dodecahedron.material = newMaterials;
                window.dodecahedronMaterials = newMaterials;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç—É—Ä—ã
                newMaterials.forEach((material, index) => {
                    if (material.map) {
                        material.map.needsUpdate = true;
                        console.log(`–ú–∞—Ç–µ—Ä–∏–∞–ª ${index + 1}: —Ç–µ–∫—Å—Ç—É—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞, —Ä–∞–∑–º–µ—Ä: ${material.map.image?.width}x${material.map.image?.height}`);
                    }
                });
                
                console.log('–†–µ–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ –¥–æ–¥–µ–∫–∞—ç–¥—Ä—É');
                console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:', newMaterials.length);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–µ–ª—å –∏ —Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                window.dodecahedron.visible = true;
                setTimeout(() => {
                    loadingOverlay.classList.add('hidden');
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                    }, 500);
                }, 300);
            }
        });
        
        // –í—ã—á–∏—Å–ª—è–µ–º –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä–∞–Ω–∏ –∑–∞—Ä–∞–Ω–µ–µ (–¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö)
        const faceOrientations = [];
        for (let i = 0; i < 12; i++) {
            faceOrientations.push(calculateFaceOrientation(geometry, i));
            console.log(`–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –≥—Ä–∞–Ω–∏ ${i + 1}:`, faceOrientations[i]);
        }
        
        // –í—Ä–µ–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç—É—Ä–∞–º–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏
        const newMaterials = [];
        for (let i = 0; i < 12; i++) {
            const tempTexture = createNumberedTexture(i + 1);
            const orientation = faceOrientations[i];
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–µ–∫—Å—Ç—É—Ä–µ
            tempTexture.offset.set(0, 0);
            tempTexture.repeat.set(1, 1);
            tempTexture.center.set(0.5, 0.5);
            tempTexture.rotation = orientation.rotation;
            
            // –ó–µ—Ä–∫–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç—É—Ä
            tempTexture.offset.x = 1;
            tempTexture.repeat.x = -1;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (orientation.flipY) {
                tempTexture.offset.y = 1;
                tempTexture.repeat.y = -1;
            }
            
            newMaterials.push(new THREE.MeshStandardMaterial({
                map: tempTexture,
                side: THREE.DoubleSide,
                transparent: false,
                opacity: 1.0,
                metalness: 0.1,
                roughness: 0.7
            }));
        }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≥–µ–æ–º–µ—Ç—Ä–∏–∏
            // DodecahedronGeometry: 12 –≥—Ä–∞–Ω–µ–π, –∫–∞–∂–¥–∞—è –≥—Ä–∞–Ω—å - –ø–µ–Ω—Ç–∞–≥–æ–Ω (5 –≤–µ—Ä—à–∏–Ω = 3 —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ = 9 –∏–Ω–¥–µ–∫—Å–æ–≤)
            const hasIndex = geometry.index !== null && geometry.index !== undefined;
            const totalIndices = hasIndex ? geometry.index.count : 108; // 12 –≥—Ä–∞–Ω–µ–π * 9 –∏–Ω–¥–µ–∫—Å–æ–≤ = 108
            const totalFaces = totalIndices / 3; // 36 —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
            const facesPerGroup = 3; // 3 —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ –Ω–∞ –≥—Ä–∞–Ω—å (–ø–µ–Ω—Ç–∞–≥–æ–Ω)
            const indicesPerGroup = 9; // 3 —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ * 3 –∏–Ω–¥–µ–∫—Å–∞ = 9
            
            console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ì–ï–û–ú–ï–¢–†–ò–ò ===');
            console.log('geometry.index —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:', hasIndex);
            console.log('–í—Å–µ–≥–æ –∏–Ω–¥–µ–∫—Å–æ–≤:', totalIndices);
            console.log('–í—Å–µ–≥–æ –≥—Ä–∞–Ω–µ–π (—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤):', totalFaces);
            console.log('–ì—Ä–∞–Ω–µ–π –Ω–∞ –≥—Ä—É–ø–ø—É:', facesPerGroup);
            console.log('–ò–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ –≥—Ä—É–ø–ø—É:', indicesPerGroup);
            console.log('–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ groups:', geometry.groups?.length || 0);
            if (geometry.groups && geometry.groups.length > 0) {
                console.log('–ü–µ—Ä–≤—ã–µ 3 groups:', geometry.groups.slice(0, 3));
            }
            
            // –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å–Ω—ã–π –º–∞—Å—Å–∏–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ
            // –í –Ω–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –∫–∞–∂–¥–∞—è –≤–µ—Ä—à–∏–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
            // –ü–æ—ç—Ç–æ–º—É –∏–Ω–¥–µ–∫—Å–Ω—ã–π –º–∞—Å—Å–∏–≤ –±—É–¥–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º: [0, 1, 2, 3, ...]
            if (!hasIndex) {
                console.log('–°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏...');
                const positions = geometry.attributes.position;
                const vertexCount = positions.count;
                const indexArray = new Uint16Array(vertexCount);
                for (let i = 0; i < vertexCount; i++) {
                    indexArray[i] = i;
                }
                geometry.setIndex(new THREE.BufferAttribute(indexArray, 1));
                console.log('–ò–Ω–¥–µ–∫—Å–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å–æ–∑–¥–∞–Ω:', vertexCount, '–∏–Ω–¥–µ–∫—Å–æ–≤');
            }
            
            // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º groups –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä–∞–Ω–∏
            // –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º groups –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞
            geometry.groups = [];
            for (let i = 0; i < 12; i++) {
                geometry.groups.push({
                    start: i * indicesPerGroup,
                    count: indicesPerGroup,
                    materialIndex: i
                });
            }
            console.log('Groups —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞:', geometry.groups.length, '–≥—Ä—É–ø–ø');
            console.log('–ü–µ—Ä–≤—ã–µ 3 groups:', geometry.groups.slice(0, 3).map(g => ({start: g.start, count: g.count, materialIndex: g.materialIndex})));
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º UV-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä –Ω–∞ –∫–∞–∂–¥–æ–π –≥—Ä–∞–Ω–∏
            const positions = geometry.attributes.position;
            // –í Three.js r128 index –º–æ–∂–µ—Ç –±—ã—Ç—å null, –Ω–æ –≥–µ–æ–º–µ—Ç—Ä–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ index –±–æ–ª–µ–µ —Ç—â–∞—Ç–µ–ª—å–Ω–æ
            const indices = geometry.index;
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
            const hasIndexForUV = indices !== null && indices !== undefined && (indices.count !== undefined ? indices.count > 0 : false);
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –º–æ–∂–µ—Ç –±—ã—Ç—å index –µ—Å—Ç—å, –Ω–æ count —Ä–∞–≤–µ–Ω 0 –∏–ª–∏ undefined
            console.log('–î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ geometry.index:');
            console.log('  geometry.index:', indices);
            console.log('  typeof geometry.index:', typeof indices);
            console.log('  geometry.index !== null:', indices !== null);
            console.log('  geometry.index !== undefined:', indices !== undefined);
            if (indices) {
                console.log('  indices.count:', indices.count);
                console.log('  indices.isBufferAttribute:', indices instanceof THREE.BufferAttribute);
            }
            
            console.log('=== –ü–ï–†–ï–°–ß–ï–¢ UV-–ö–û–û–†–î–ò–ù–ê–¢ ===');
            console.log('positions —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:', !!positions);
            console.log('indices —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:', hasIndexForUV);
            if (positions) console.log('positions.count:', positions.count);
            if (hasIndexForUV) console.log('indices.count:', indices.count);
            console.log('geometry.index:', geometry.index);
            console.log('geometry.attributes.uv —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:', !!geometry.attributes.uv);
            
            if (!positions) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ UV');
            } else if (!hasIndexForUV) {
                // –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å UV, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ positions –∏ groups
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –Ω–∞—Ö–æ–¥–∏–º –≤–µ—Ä—à–∏–Ω—ã –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏
                console.log('–ò–Ω–¥–µ–∫—Å—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º UV –Ω–∞ –æ—Å–Ω–æ–≤–µ positions –∏ groups');
                
                let uv = geometry.attributes.uv;
                if (!uv) {
                    uv = new THREE.BufferAttribute(new Float32Array(positions.count * 2), 2);
                    geometry.setAttribute('uv', uv);
                    console.log('UV-–∞—Ç—Ä–∏–±—É—Ç —Å–æ–∑–¥–∞–Ω');
                }
                
                // –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –Ω–∞—Ö–æ–¥–∏–º –≤–µ—Ä—à–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —ç—Ç–æ–π –≥—Ä–∞–Ω–∏
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –≤–µ—Ä—à–∏–Ω—ã –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ —Ü–µ–Ω—Ç—Ä—É –≥—Ä—É–ø–ø—ã
                for (let groupIndex = 0; groupIndex < geometry.groups.length; groupIndex++) {
                    const group = geometry.groups[groupIndex];
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ü–µ–Ω—Ç—Ä –≥—Ä—É–ø–ø—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ start –ø–æ–∑–∏—Ü–∏–∏
                    // –í DodecahedronGeometry –∫–∞–∂–¥–∞—è –≥—Ä–∞–Ω—å –∏–º–µ–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 5 –≤–µ—Ä—à–∏–Ω
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –Ω–∞—Ö–æ–¥–∏–º –≤–µ—Ä—à–∏–Ω—ã –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –≥—Ä—É–ø–ø—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –≤–µ—Ä—à–∏–Ω
                    // –ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ –∏–º–µ–µ—Ç start –∏ count, –Ω–æ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–ª–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–µ—Ä—à–∏–Ω—ã
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ UV
                    // –¥–ª—è –≤–µ—Ä—à–∏–Ω, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —ç—Ç–æ–π –≥—Ä–∞–Ω–∏
                    
                    // –ü—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥: –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UV –≤ —Ü–µ–Ω—Ç—Ä (0.5, 0.5)
                    // –¥–ª—è –≤—Å–µ—Ö –≤–µ—Ä—à–∏–Ω, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å —ç—Ç–æ–π –≥—Ä—É–ø–ø–æ–π
                    // –ù–æ —ç—Ç–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥
                    
                    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ UV, –Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∏—Ö –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
                    // –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –Ω–∞—Ö–æ–¥–∏–º –≤–µ—Ä—à–∏–Ω—ã –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ —Ü–µ–Ω—Ç—Ä—É –≥—Ä—É–ø–ø—ã
                }
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ UV –∏–∑ –≥–µ–æ–º–µ—Ç—Ä–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                // –ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ UV –≤ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                if (geometry.attributes.uv && geometry.attributes.uv.count === positions.count) {
                    console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ UV-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ –≥–µ–æ–º–µ—Ç—Ä–∏–∏');
                    // UV —É–∂–µ –µ—Å—Ç—å, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º –∏—Ö
                } else {
                    // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ UV –≤ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                    for (let i = 0; i < positions.count; i++) {
                        uv.setXY(i, 0.5, 0.5);
                    }
                    uv.needsUpdate = true;
                    console.log('UV-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ —Ü–µ–Ω—Ç—Ä –¥–ª—è –≤—Å–µ—Ö –≤–µ—Ä—à–∏–Ω (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥)');
                }
            } else {
                
                // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º UV-–∞—Ç—Ä–∏–±—É—Ç
                const uvCount = positions.count;
                let uv = geometry.attributes.uv;
                
                if (!uv) {
                    uv = new THREE.BufferAttribute(new Float32Array(uvCount * 2), 2);
                    geometry.setAttribute('uv', uv);
                    console.log('UV-–∞—Ç—Ä–∏–±—É—Ç —Å–æ–∑–¥–∞–Ω');
                }
                
                // –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã (–≥—Ä–∞–Ω–∏) –≤—ã—á–∏—Å–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ UV-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                for (let groupIndex = 0; groupIndex < geometry.groups.length; groupIndex++) {
                    const group = geometry.groups[groupIndex];
                    
                    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –≤–µ—Ä—à–∏–Ω –¥–ª—è —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã
                    const vertexIndices = [];
                    const vertexSet = new Set();
                    
                    for (let i = 0; i < group.count; i++) {
                        const indexPos = group.start + i;
                        if (indexPos < indices.count) {
                            const vertexIndex = indices.getX(indexPos);
                            if (!vertexSet.has(vertexIndex)) {
                                vertexSet.add(vertexIndex);
                                vertexIndices.push(vertexIndex);
                            }
                        }
                    }
                    
                    if (vertexIndices.length < 3) continue;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –≤–µ—Ä—à–∏–Ω—ã –≥—Ä–∞–Ω–∏
                    const vertices = vertexIndices.map(idx => new THREE.Vector3(
                        positions.getX(idx),
                        positions.getY(idx),
                        positions.getZ(idx)
                    ));
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ—Ä–º–∞–ª—å –≥—Ä–∞–Ω–∏
                    const v0 = vertices[0];
                    const v1 = vertices[1];
                    const v2 = vertices[2];
                    const normal = new THREE.Vector3()
                        .subVectors(v1, v0)
                        .cross(new THREE.Vector3().subVectors(v2, v0))
                        .normalize();
                    
                    // –°–æ–∑–¥–∞–µ–º –±–∞–∑–∏—Å –¥–ª—è –ø—Ä–æ–µ–∫—Ü–∏–∏ –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç—å –≥—Ä–∞–Ω–∏
                    const up = new THREE.Vector3(0, 1, 0);
                    const right = new THREE.Vector3().crossVectors(up, normal).normalize();
                    if (right.length() < 0.1) {
                        up.set(1, 0, 0);
                        right.crossVectors(up, normal).normalize();
                    }
                    const forward = new THREE.Vector3().crossVectors(normal, right).normalize();
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –≥—Ä–∞–Ω–∏
                    const center = new THREE.Vector3();
                    vertices.forEach(v => center.add(v));
                    center.divideScalar(vertices.length);
                    
                    // –ü—Ä–æ–µ—Ü–∏—Ä—É–µ–º –≤–µ—Ä—à–∏–Ω—ã –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç—å –∏ –≤—ã—á–∏—Å–ª—è–µ–º UV
                    let minU = Infinity, maxU = -Infinity;
                    let minV = Infinity, maxV = -Infinity;
                    const projectedUVs = [];
                    
                    vertices.forEach((vertex, idx) => {
                        const localPos = new THREE.Vector3().subVectors(vertex, center);
                        const u = localPos.dot(right);
                        const v = localPos.dot(forward);
                        projectedUVs.push({ u, v, vertexIndex: vertexIndices[idx] });
                        minU = Math.min(minU, u);
                        maxU = Math.max(maxU, u);
                        minV = Math.min(minV, v);
                        maxV = Math.max(maxV, v);
                    });
                    
                    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º UV-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É [0, 1] –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º
                    const rangeU = maxU - minU || 1;
                    const rangeV = maxV - minV || 1;
                    const scale = 0.8; // –ú–∞—Å—à—Ç–∞–± –¥–ª—è —É—á–µ—Ç–∞ –∫—Ä–∞–µ–≤
                    
                    projectedUVs.forEach(({ u, v, vertexIndex }) => {
                        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º
                        const normalizedU = 0.5 + (u - (minU + maxU) / 2) / rangeU * scale;
                        const normalizedV = 0.5 + (v - (minV + maxV) / 2) / rangeV * scale;
                        uv.setXY(vertexIndex, normalizedU, normalizedV);
                    });
                }
                
                uv.needsUpdate = true;
                console.log('UV-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö –≥—Ä–∞–Ω–µ–π');
                console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø:', geometry.groups.length);
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ–∫—Å—Ç—É—Ä)
            // –†–µ–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ Promise.all –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            window.dodecahedron.material = newMaterials;
            window.dodecahedronMaterials = newMaterials;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–µ–ª—å —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç—É—Ä–∞–º–∏
            window.dodecahedron.visible = true;
            
            console.log('–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã');
            console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø –í–†–ï–ú–ï–ù–ù–´–• –ú–ê–¢–ï–†–ò–ê–õ–û–í ===');
            console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:', newMaterials.length);
            console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ groups:', geometry.groups.length);
            console.log('–ù–æ–≤—ã–π —Ç–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞:', newMaterials[0]?.type);
            console.log('–ú–∞—Ç–µ—Ä–∏–∞–ª –∏–º–µ–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä—É:', !!newMaterials[0]?.map);
            console.log('–î–æ–¥–µ–∫–∞—ç–¥—Ä visible:', window.dodecahedron.visible);
        
        // –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–æ—Ä–∞ –∏ –≤—Ä–∞—â–µ–Ω–∏—è –≥—Ä–∞–Ω–∏ - –æ–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –î–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        let selectedFaceIndex = -1;
        let faceControlsPanel = document.getElementById('face-controls-panel');
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let isDraggingForRotation = false;
        let dragStartPosition = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –≤—ã–±–æ—Ä–∞ –≥—Ä–∞–Ω–∏ –∏ —Å–ø–∏—Å–∫–∞ –≥—Ä–∞–Ω–µ–π
        try {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ –≥—Ä–∞–Ω–µ–π –∏ —Å–ø–∏—Å–∫–∞');
            faceListElement = document.getElementById('face-list');
            if (!faceListElement) {
                console.error('–≠–ª–µ–º–µ–Ω—Ç #face-list –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM');
            }
            initFaceSelection();
            initFaceList();
        } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –≥—Ä–∞–Ω–µ–π:', e);
        }
        
        // –ù–∞—á–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –≥—Ä–∞–Ω—å 1 ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ª–æ–≥–∏–∫–æ–π –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞
        setTimeout(() => {
            if (window.dodecahedron) {
                camera.position.set(0, 0, initialCameraZ);
                deselectFace();
                centerOnFace(0); // –ì—Ä–∞–Ω—å 1 –∏–º–µ–µ—Ç –∏–Ω–¥–µ–∫—Å 0
                selectFace(0);   // –í—ã–¥–µ–ª—è–µ–º –≥—Ä–∞–Ω—å 1
                rotateFace(Math.PI); // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ 180¬∞
            }
        }, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ –≤—Å–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

        // –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        const hintNotification = document.getElementById('hint-notification');
        const closeHintBtn = document.getElementById('close-hint');
        const hintTextDesktop = document.getElementById('hint-text-desktop');
        const hintTextMobile = document.getElementById('hint-text-mobile');
        
        let userInteracted = false;
        let hintTimer = null;
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        if (isMobile) {
            hintTextDesktop.style.display = 'none';
            hintTextMobile.style.display = 'block';
        } else {
            hintTextDesktop.style.display = 'block';
            hintTextMobile.style.display = 'none';
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function hideHint() {
            hintNotification.classList.remove('show');
            userInteracted = true;
            if (hintTimer) {
                clearTimeout(hintTimer);
                hintTimer = null;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showHint() {
            if (!userInteracted) {
                hintNotification.classList.add('show');
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
        hintTimer = setTimeout(showHint, 10000);
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–Ω–æ–ø–∫–µ
        closeHintBtn.addEventListener('click', hideHint);
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        hintNotification.addEventListener('click', (e) => {
            if (e.target === hintNotification) {
                hideHint();
            }
        });
        
        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        function registerInteraction() {
            if (!userInteracted) {
                hideHint();
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à—å—é –∏ —Ç–∞—á–µ–º
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let rotationSpeed = 0.005;
        let initialCameraZ = 5;
        
        // –í—Ä–∞—â–µ–Ω–∏–µ –º—ã—à—å—é
        let mouseDownTime = 0;
        let mouseDownPosition = null;
        
        renderer.domElement.addEventListener('mousedown', (e) => {
            mouseDownTime = Date.now();
            mouseDownPosition = { x: e.clientX, y: e.clientY };
            previousMousePosition = { x: e.clientX, y: e.clientY };
            isDragging = false;
        });

        renderer.domElement.addEventListener('mousemove', (e) => {
            if (mouseDownPosition) {
                const moveDistance = Math.hypot(
                    e.clientX - mouseDownPosition.x,
                    e.clientY - mouseDownPosition.y
                );
                
                // –ï—Å–ª–∏ –º—ã—à—å –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 5 –ø–∏–∫—Å–µ–ª–µ–π - –Ω–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                if (moveDistance > 5) {
                    isDragging = true;
                }
            }
            
            if (isDragging && window.dodecahedron) {
                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ (–¥–ª—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏)
                window.dodecahedron.rotation.y += deltaX * rotationSpeed;
                window.dodecahedron.rotation.x += deltaY * rotationSpeed;
                
                // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —É–≥–ª–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
                if (Math.abs(window.dodecahedron.rotation.x) > Math.PI * 2) {
                    window.dodecahedron.rotation.x = window.dodecahedron.rotation.x % (Math.PI * 2);
                }
                if (Math.abs(window.dodecahedron.rotation.y) > Math.PI * 2) {
                    window.dodecahedron.rotation.y = window.dodecahedron.rotation.y % (Math.PI * 2);
                }
                
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º targetRotation –∏ currentRotation —Å —Ç–µ–∫—É—â–∏–º rotation
                targetRotation.y = window.dodecahedron.rotation.y;
                targetRotation.x = window.dodecahedron.rotation.x;
                currentRotation.y = window.dodecahedron.rotation.y;
                currentRotation.x = window.dodecahedron.rotation.x;
                
                previousMousePosition = { x: e.clientX, y: e.clientY };
                registerInteraction();
            }
        });

        renderer.domElement.addEventListener('mouseup', () => {
            isDragging = false;
            mouseDownPosition = null;
        });

        renderer.domElement.addEventListener('mouseleave', () => {
            isDragging = false;
            mouseDownPosition = null;
        });

        // –ó—É–º –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏
        renderer.domElement.addEventListener('wheel', (e) => {
            e.preventDefault();
            camera.position.z += e.deltaY * 0.01;
            camera.position.z = Math.max(2, Math.min(10, camera.position.z));
            registerInteraction();
        });

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—á–µ–º –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        let touchStart = null;
        let previousTouchPosition = null;
        let touchStartDistance = 0;
        let touchStartZoom = initialCameraZ;
        let lastTouchDistance = 0;
        let isTouchDragging = false;

        renderer.domElement.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                previousTouchPosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                isTouchDragging = false;
                registerInteraction();
            } else if (e.touches.length === 2) {
                touchStartDistance = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                touchStartZoom = camera.position.z;
                lastTouchDistance = touchStartDistance;
                registerInteraction();
            }
        });

        renderer.domElement.addEventListener('touchmove', (e) => {
            e.preventDefault();
            
            if (e.touches.length === 1 && touchStart && previousTouchPosition && window.dodecahedron) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–æ –ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                if (!isTouchDragging) {
                    const moveDistance = Math.hypot(
                        e.touches[0].clientX - touchStart.x,
                        e.touches[0].clientY - touchStart.y
                    );
                    if (moveDistance > 5) {
                        isTouchDragging = true;
                    }
                }
                
                if (isTouchDragging) {
                    // –í—Ä–∞—â–µ–Ω–∏–µ –æ–¥–Ω–∏–º –ø–∞–ª—å—Ü–µ–º - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª—å—Ç—É –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ (–∫–∞–∫ –≤ –º—ã—à–∏)
                    const deltaX = e.touches[0].clientX - previousTouchPosition.x;
                    const deltaY = e.touches[0].clientY - previousTouchPosition.y;
                    
                    // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ –Ω–∞ —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                    window.dodecahedron.rotation.y += deltaX * rotationSpeed * 2;
                    window.dodecahedron.rotation.x += deltaY * rotationSpeed * 2;
                    
                    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —É–≥–ª–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
                    if (Math.abs(window.dodecahedron.rotation.x) > Math.PI * 2) {
                        window.dodecahedron.rotation.x = window.dodecahedron.rotation.x % (Math.PI * 2);
                    }
                    if (Math.abs(window.dodecahedron.rotation.y) > Math.PI * 2) {
                        window.dodecahedron.rotation.y = window.dodecahedron.rotation.y % (Math.PI * 2);
                    }
                    
                    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º targetRotation –∏ currentRotation —Å —Ç–µ–∫—É—â–∏–º rotation
                    targetRotation.y = window.dodecahedron.rotation.y;
                    targetRotation.x = window.dodecahedron.rotation.x;
                    currentRotation.y = window.dodecahedron.rotation.y;
                    currentRotation.x = window.dodecahedron.rotation.x;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–∞–¥—Ä–∞
                    previousTouchPosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                    registerInteraction();
                }
            } else if (e.touches.length === 2) {
                // –ó—É–º –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
                const touchDistance = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                
                const zoomDelta = (touchDistance - lastTouchDistance) * 0.01;
                camera.position.z = touchStartZoom - zoomDelta;
                camera.position.z = Math.max(2, Math.min(10, camera.position.z));
                
                lastTouchDistance = touchDistance;
                registerInteraction();
            }
        });

        renderer.domElement.addEventListener('touchend', () => {
            touchStart = null;
            previousTouchPosition = null;
            touchStartDistance = 0;
            lastTouchDistance = 0;
            isTouchDragging = false;
        });

        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑—É–º–æ–º
        document.getElementById('zoom-in').addEventListener('click', () => {
            camera.position.z = Math.max(2, camera.position.z - 0.5);
            registerInteraction();
        });

        document.getElementById('zoom-out').addEventListener('click', () => {
            camera.position.z = Math.min(10, camera.position.z + 0.5);
            registerInteraction();
        });

        // –°–±—Ä–æ—Å –≤–∏–¥–∞ - –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥—Ä–∞–Ω—å 1 (–ø–æ–≤–µ—Ä–Ω—É—Ç–∞ –Ω–∞ 180¬∞)
        document.getElementById('reset').addEventListener('click', () => {
            camera.position.set(0, 0, initialCameraZ);
            if (window.dodecahedron) {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                deselectFace();
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –Ω–∞ –≥—Ä–∞–Ω–∏ 1 (–∏–Ω–¥–µ–∫—Å 0)
                centerOnFace(0);
                // –í—ã–¥–µ–ª—è–µ–º –≥—Ä–∞–Ω—å 1
                selectFace(0);
                // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≥—Ä–∞–Ω—å 1 –Ω–∞ 180¬∞ –≤–æ–∫—Ä—É–≥ –æ—Å–∏ –∫–∞–º–µ—Ä—ã
                rotateFace(Math.PI);
            }
            registerInteraction();
        });

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∞–º–∏
        document.addEventListener('keydown', (e) => {
            if (window.dodecahedron) {
                switch(e.key) {
                    case 'ArrowLeft':
                        window.dodecahedron.rotation.y += 0.1;
                        registerInteraction();
                        break;
                    case 'ArrowRight':
                        window.dodecahedron.rotation.y -= 0.1;
                        registerInteraction();
                        break;
                    case 'ArrowUp':
                        window.dodecahedron.rotation.x += 0.1;
                        registerInteraction();
                        break;
                    case 'ArrowDown':
                        window.dodecahedron.rotation.x -= 0.1;
                        registerInteraction();
                        break;
                }
            }
        });


        function updateFaceListSelection() {
            if (!faceListElement) return;
            const items = faceListElement.querySelectorAll('.face-list-item');
            items.forEach((item, index) => {
                item.classList.toggle('active', index === selectedFaceIndex);
            });
        }

        function initFaceSelection() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥—Ä–∞–Ω–∏
            renderer.domElement.addEventListener('click', (e) => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–æ –ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                if (mouseDownPosition) {
                    const moveDistance = Math.hypot(
                        e.clientX - mouseDownPosition.x,
                        e.clientY - mouseDownPosition.y
                    );
                    
                    // –ï—Å–ª–∏ –±—ã–ª–æ –¥–≤–∏–∂–µ–Ω–∏–µ –±–æ–ª–µ–µ 5 –ø–∏–∫—Å–µ–ª–µ–π - —ç—Ç–æ –±—ã–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ, –Ω–µ –∫–ª–∏–∫
                    if (moveDistance > 5 || isDragging) {
                        return;
                    }
                }
                
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
                
                raycaster.setFromCamera(mouse, camera);
                
                if (window.dodecahedron) {
                    const intersects = raycaster.intersectObject(window.dodecahedron);
                    
                    if (intersects.length > 0) {
                        const faceIndex = intersects[0].face.materialIndex;
                        selectFace(faceIndex);
                        registerInteraction();
                    }
                }
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞—á–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥—Ä–∞–Ω–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            let touchStartTime = 0;
            let touchStartPos = null;
            
            renderer.domElement.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    touchStartTime = Date.now();
                    touchStartPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                }
            });

            renderer.domElement.addEventListener('touchend', (e) => {
                if (e.changedTouches.length === 1 && touchStartPos) {
                    const touchEnd = e.changedTouches[0];
                    const touchDuration = Date.now() - touchStartTime;
                    const touchDistance = Math.hypot(
                        touchEnd.clientX - touchStartPos.x,
                        touchEnd.clientY - touchStartPos.y
                    );
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ –±–µ–∑ –¥–≤–∏–∂–µ–Ω–∏—è - –≤—ã–±–∏—Ä–∞–µ–º –≥—Ä–∞–Ω—å
                    if (touchDuration < 300 && touchDistance < 10) {
                        mouse.x = (touchEnd.clientX / window.innerWidth) * 2 - 1;
                        mouse.y = -(touchEnd.clientY / window.innerHeight) * 2 + 1;
                        
                        raycaster.setFromCamera(mouse, camera);
                        
                        if (window.dodecahedron) {
                            const intersects = raycaster.intersectObject(window.dodecahedron);
                            
                            if (intersects.length > 0) {
                                const faceIndex = intersects[0].face.materialIndex;
                                selectFace(faceIndex);
                                registerInteraction();
                            }
                        }
                    }
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä–∞–Ω–∏
        function centerOnFace(faceIndex) {
            if (!window.dodecahedron || faceIndex < 0) return;
            
            const geometry = window.dodecahedron.geometry;
            if (!geometry.groups || geometry.groups.length === 0) return;
            
            const group = geometry.groups[faceIndex];
            if (!group) return;
            
            const positions = geometry.attributes.position;
            const indices = geometry.index;
            if (!positions || !indices) return;
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–µ—Ä—à–∏–Ω—ã –≥—Ä–∞–Ω–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞
            const faceVertices = [];
            const vertexSet = new Set();
            
            for (let i = 0; i < group.count; i++) {
                const indexPos = group.start + i;
                if (indexPos < indices.count) {
                    const vertexIndex = indices.getX(indexPos);
                    if (!vertexSet.has(vertexIndex)) {
                        vertexSet.add(vertexIndex);
                        faceVertices.push(new THREE.Vector3(
                            positions.getX(vertexIndex),
                            positions.getY(vertexIndex),
                            positions.getZ(vertexIndex)
                        ));
                    }
                }
            }
            
            if (faceVertices.length < 3) return;
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –≥—Ä–∞–Ω–∏
            const faceCenter = new THREE.Vector3();
            faceVertices.forEach(v => faceCenter.add(v));
            faceCenter.divideScalar(faceVertices.length);
            
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ—Ä–º–∞–ª—å –≥—Ä–∞–Ω–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–µ 3 –≤–µ—Ä—à–∏–Ω—ã)
            const v0 = faceVertices[0];
            const v1 = faceVertices[1];
            const v2 = faceVertices[2];
            const edge1 = new THREE.Vector3().subVectors(v1, v0);
            const edge2 = new THREE.Vector3().subVectors(v2, v0);
            let faceNormal = new THREE.Vector3().crossVectors(edge1, edge2).normalize();
            
            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –∫–∞–º–µ—Ä–µ (–≤–¥–æ–ª—å –æ—Å–∏ Z, –Ω–æ –æ—Ç –æ–±—ä–µ–∫—Ç–∞ –∫ –∫–∞–º–µ—Ä–µ)
            const cameraDirection = new THREE.Vector3(0, 0, -1); // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ Z, —Ç–∞–∫ –∫–∞–∫ –∫–∞–º–µ—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç –≤ -Z
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å
            // –ï—Å–ª–∏ –Ω–æ—Ä–º–∞–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞, –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫ –∫–∞–º–µ—Ä–µ
            const toCenter = new THREE.Vector3().subVectors(new THREE.Vector3(0, 0, 0), faceCenter).normalize();
            if (faceNormal.dot(toCenter) < 0) {
                faceNormal.negate();
            }
            
            // –í—ã—á–∏—Å–ª—è–µ–º –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–æ—Ä–º–∞–ª–∏ –≥—Ä–∞–Ω–∏ –∫ –∫–∞–º–µ—Ä–µ
            const quaternion = new THREE.Quaternion().setFromUnitVectors(faceNormal, cameraDirection);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º targetRotation –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
            // currentRotation –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º rotation –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞
            const euler = new THREE.Euler().setFromQuaternion(quaternion);
            targetRotation = { x: euler.x, y: euler.y, z: euler.z };
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º currentRotation —Å —Ç–µ–∫—É—â–∏–º rotation –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
            currentRotation = { 
                x: window.dodecahedron.rotation.x, 
                y: window.dodecahedron.rotation.y, 
                z: window.dodecahedron.rotation.z 
            };
            
        }
        
        function selectFace(faceIndex) {
            const materials = Array.isArray(window.dodecahedron.material) 
                ? window.dodecahedron.material 
                : [window.dodecahedron.material];
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≥—Ä–∞–Ω–∏
            if (selectedFaceIndex >= 0 && materials[selectedFaceIndex]) {
                if (materials[selectedFaceIndex].emissive) {
                    materials[selectedFaceIndex].emissive.setHex(0x000000);
                    materials[selectedFaceIndex].emissiveIntensity = 0;
                }
            }
            
            // –í—ã–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é –≥—Ä–∞–Ω—å
            selectedFaceIndex = faceIndex;
            if (materials[faceIndex] && materials[faceIndex].emissive) {
                materials[faceIndex].emissive.setHex(0x6496ff);
                materials[faceIndex].emissiveIntensity = 0.3;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –≥—Ä–∞–Ω–µ–π
            updateFaceListSelection();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞–Ω—å—é
            faceControlsPanel.classList.add('active');
        }

        function deselectFace() {
            const materials = Array.isArray(window.dodecahedron.material) 
                ? window.dodecahedron.material 
                : [window.dodecahedron.material];
            
            if (selectedFaceIndex >= 0 && materials[selectedFaceIndex] && materials[selectedFaceIndex].emissive) {
                materials[selectedFaceIndex].emissive.setHex(0x000000);
                materials[selectedFaceIndex].emissiveIntensity = 0;
            }
            selectedFaceIndex = -1;
            faceControlsPanel.classList.remove('active');
            updateFaceListSelection();
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
        let targetRotation = { x: 0, y: 0, z: 0 };
        let currentRotation = { x: 0, y: 0, z: 0 };
        const smoothRotationSpeed = 0.1; // –°–∫–æ—Ä–æ—Å—Ç—å –ø–ª–∞–≤–Ω–æ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è
        const faceRotationStep = (2 * Math.PI) / 10; // 36¬∞: –ø–æ–ª–Ω—ã–π –æ–±–æ—Ä–æ—Ç –∑–∞ 10 —à–∞–≥–æ–≤
        
        function rotateFace(angle) {
            if (selectedFaceIndex < 0 || !window.dodecahedron) return;
            
            // –ü–æ—Å–ª–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ—Ä–º–∞–ª—å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä–∞–Ω–∏ –≤—ã—Ä–æ–≤–Ω–µ–Ω–∞ —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–∞–º–µ—Ä—ã (0,0,-1)
            // –ü–æ—ç—Ç–æ–º—É, —á—Ç–æ–±—ã –∫—Ä—É—Ç–∏—Ç—å –≥—Ä–∞–Ω—å –∫–∞–∫ ¬´–º–æ–Ω–µ—Ç–∫—É¬ª –∏ –Ω–µ —É–≤–æ–¥–∏—Ç—å –µ—ë –∏–∑ —Ü–µ–Ω—Ç—Ä–∞,
            // –≤—Ä–∞—â–∞–µ–º –≤–µ—Å—å –¥–æ–¥–µ–∫–∞—ç–¥—Ä –≤–æ–∫—Ä—É–≥ –ú–ò–†–û–í–û–ô –æ—Å–∏, —Å–æ–≤–ø–∞–¥–∞—é—â–µ–π —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–∞–º–µ—Ä—ã.
            const worldAxis = new THREE.Vector3(0, 0, -1); // –æ—Å—å –≤–¥–æ–ª—å –≤–∑–≥–ª—è–¥–∞ –∫–∞–º–µ—Ä—ã
            
            const currentQuaternion = window.dodecahedron.quaternion.clone();
            const rotationQuaternion = new THREE.Quaternion().setFromAxisAngle(worldAxis, angle);
            
            // –í–∞–∂–Ω–æ: —Å–Ω–∞—á–∞–ª–∞ –ø–æ–≤–æ—Ä–æ—Ç –≤–æ–∫—Ä—É–≥ –æ—Å–∏ –∫–∞–º–µ—Ä—ã, –ø–æ—Ç–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è
            const newQuaternion = rotationQuaternion.multiply(currentQuaternion);
            
            const euler = new THREE.Euler().setFromQuaternion(newQuaternion);
            targetRotation = { x: euler.x, y: euler.y, z: euler.z };
            
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–ª–∞–≤–Ω–æ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è
        function smoothRotate() {
            if (!window.dodecahedron) return;

            // –ù–µ –≤–º–µ—à–∏–≤–∞–µ–º—Å—è –≤ —Ä—É—á–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –º—ã—à—å—é/—Ç–∞—á–µ–º, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ ¬´—Ä—ã–≤–∫–æ–≤¬ª
            if (isDragging || isDraggingForRotation || isTouchDragging) return;
            
            // –ü–ª–∞–≤–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è
            const currentQuat = new THREE.Quaternion().setFromEuler(
                new THREE.Euler(currentRotation.x, currentRotation.y, currentRotation.z)
            );
            const targetQuat = new THREE.Quaternion().setFromEuler(
                new THREE.Euler(targetRotation.x, targetRotation.y, targetRotation.z)
            );
            
            // –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ–º –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω—ã
            currentQuat.slerp(targetQuat, smoothRotationSpeed);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º rotation –∏–∑ –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω–∞
            const euler = new THREE.Euler().setFromQuaternion(currentQuat);
            currentRotation = { x: euler.x, y: euler.y, z: euler.z };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –µ—â–µ –æ–±–Ω–æ–≤–ª—è—Ç—å
            const distance = currentQuat.angleTo(targetQuat);
            if (distance > 0.001) {
                window.dodecahedron.rotation.set(currentRotation.x, currentRotation.y, currentRotation.z);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤—Ä–∞—â–µ–Ω–∏—è –≥—Ä–∞–Ω–∏
        document.getElementById('face-rotate-left').addEventListener('click', () => {
            // –í—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 72¬∞ –≤–ª–µ–≤–æ: –ø–æ–ª–Ω—ã–π –æ–±–æ—Ä–æ—Ç –∑–∞ 5 –∫–ª–∏–∫–æ–≤
            rotateFace(-faceRotationStep);
            registerInteraction();
        });

        document.getElementById('face-rotate-right').addEventListener('click', () => {
            // –í—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 72¬∞ –≤–ø—Ä–∞–≤–æ: –ø–æ–ª–Ω—ã–π –æ–±–æ—Ä–æ—Ç –∑–∞ 5 –∫–ª–∏–∫–æ–≤
            rotateFace(faceRotationStep);
            registerInteraction();
        });

        document.getElementById('face-deselect').addEventListener('click', () => {
            deselectFace();
            registerInteraction();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –≥—Ä–∞–Ω–µ–π (–Ω–æ–º–µ—Ä–∞ 1‚Äì12)
        function initFaceList() {
            try {
                if (!faceListElement) {
                    console.warn('faceListElement –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                faceListElement.innerHTML = '';
                
                for (let i = 0; i < 12; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'face-list-item';
                    btn.textContent = String(i + 1);
                    btn.dataset.faceIndex = i.toString();
                    
                    btn.addEventListener('click', () => {
                        // –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–∑ —Å–ø–∏—Å–∫–∞: –≤—ã–¥–µ–ª—è–µ–º –≥—Ä–∞–Ω—å –∏ –ø–ª–∞–≤–Ω–æ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞–º–µ—Ä—É –Ω–∞ –Ω–µ–π
                        selectFace(i);
                        centerOnFace(i);
                        registerInteraction();
                    });
                    
                    faceListElement.appendChild(btn);
                }
                
                // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏ 1
                selectedFaceIndex = 0;
                updateFaceListSelection();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ initFaceList:', e);
            }
        }

        // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // –ê–Ω–∏–º–∞—Ü–∏—è
        let renderCallCount = 0;
        function animate() {
            requestAnimationFrame(animate);
            
            // –ü–ª–∞–≤–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –¥–æ–¥–µ–∫–∞—ç–¥—Ä–∞
            smoothRotate();
            
            renderer.render(scene, camera);
            renderCallCount++;
        }
        
        console.log('–ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏...');
        console.log('–°—Ü–µ–Ω–∞:', scene);
        console.log('–ö–∞–º–µ—Ä–∞:', camera);
        console.log('–†–µ–Ω–¥–µ—Ä–µ—Ä:', renderer);
        
        animate();
    </script>
</body>
</html>

